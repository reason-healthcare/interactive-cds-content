{
	"info": {
		"_postman_id": "c7275978-8ff2-42a6-ba3f-b4baa1de219c",
		"name": "PlanDefinition $questionnaire",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
		"_exporter_id": "25403373"
	},
	"item": [
		{
			"name": "Case1",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							""
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [],
				"body": {
					"mode": "raw",
					"raw": "{\n  \"resourceType\": \"Parameters\",\n  \"id\": \"Parameters1\",\n  \"parameter\": [\n    {\n      \"name\": \"url\",\n      \"valueUri\": \"http://example.org/PlanDefinition/SulfasalazineMonitoringRecommendation\"\n    },\n    {\n      \"name\": \"version\",\n      \"valueString\": \"0.1.0\"\n    },\n    {\n      \"name\": \"data\",\n      \"resource\": {\n        \"resourceType\": \"Bundle\",\n        \"id\": \"BundleCase7\",\n        \"type\": \"collection\",\n        \"entry\": [\n          {\n            \"fullUrl\": \"http://example.org/Patient/Patient7\",\n            \"resource\": {\n              \"resourceType\": \"Patient\",\n              \"id\": \"Patient7\",\n              \"name\": [\n                {\n                  \"family\": \"patient7\"\n                }\n              ]\n            }\n          },\n          {\n            \"fullUrl\": \"http://example.org/Practitioner/PractitionerShared\",\n            \"resource\": {\n              \"resourceType\": \"Practitioner\",\n              \"id\": \"PractitionerShared\",\n              \"name\": [\n                {\n                  \"family\": \"practitionershared\"\n                }\n              ]\n            }\n          },\n          {\n            \"fullUrl\": \"http://example.org/Organization/OrganizationShared\",\n            \"resource\": {\n              \"resourceType\": \"Organization\",\n              \"id\": \"OrganizationShared\",\n              \"name\": \"organizationshared\"\n            }\n          },\n          {\n            \"fullUrl\": \"http://example.org/Encounter/Encounter7\",\n            \"resource\": {\n              \"resourceType\": \"Encounter\",\n              \"id\": \"Encounter7\",\n              \"status\": \"in-progress\",\n              \"class\": {\n                \"code\": \"AMB\",\n                \"system\": \"http://terminology.hl7.org/CodeSystem/v3-ActCode\",\n                \"display\": \"ambulatory\"\n              },\n              \"subject\": {\n                \"reference\": \"Patient/Patient7\"\n              },\n              \"participant\": [\n                {\n                  \"type\": [\n                    {\n                      \"coding\": [\n                        {\n                          \"code\": \"PPRF\",\n                          \"system\": \"http://terminology.hl7.org/CodeSystem/v3-ParticipationType\",\n                          \"display\": \"primary performer\"\n                        }\n                      ]\n                    }\n                  ],\n                  \"individual\": {\n                    \"reference\": \"Practitioner/PractitionerShared\"\n                  }\n                }\n              ],\n              \"serviceProvider\": {\n                \"reference\": \"Organization/OrganizationShared\"\n              }\n            }\n          },\n          {\n            \"fullUrl\": \"http://example.org/Observation/MedObservation7\",\n            \"resource\": {\n              \"resourceType\": \"Observation\",\n              \"id\": \"MedObservation7\",\n              \"status\": \"final\",\n              \"code\": {\n                \"coding\": [\n                  {\n                    \"code\": \"on-medication-sulfasalazine\",\n                    \"system\": \"http://example.org/CodeSystem/CaseFeatureCodes\"\n                  }\n                ]\n              },\n              \"subject\": {\n                \"reference\": \"Patient/Patient7\"\n              },\n              \"performer\": [\n                {\n                  \"reference\": \"Organization/OrganizationShared\"\n                }\n              ],\n              \"valueBoolean\": true\n            }\n          },\n          {\n            \"fullUrl\": \"http://example.org/Observation/CBCObservation7\",\n            \"resource\": {\n              \"resourceType\": \"Observation\",\n              \"id\": \"CBCObservation7\",\n              \"status\": \"final\",\n              \"code\": {\n                \"coding\": [\n                  {\n                    \"code\": \"last-cbc-panel-report-date\",\n                    \"system\": \"http://example.org/CodeSystem/CaseFeatureCodes\"\n                  }\n                ]\n              },\n              \"subject\": {\n                \"reference\": \"Patient/Patient7\"\n              },\n              \"performer\": [\n                {\n                  \"reference\": \"Organization/OrganizationShared\"\n                }\n              ],\n              \"valueDateTime\": \"2023-05-06T10:10:00+11:00\"\n            }\n          },\n          {\n            \"fullUrl\": \"http://example.org/Observation/r7-1\",\n            \"resource\": {\n              \"resourceType\": \"Observation\",\n              \"id\": \"r7-1\",\n              \"status\": \"final\",\n              \"code\": {\n                \"coding\": [\n                  {\n                    \"code\": \"718-7\",\n                    \"system\": \"http://loinc.org\",\n                    \"display\": \"Hemoglobin [Mass/volume] in Blood\"\n                  }\n                ],\n                \"text\": \"Haemoglobin\"\n              },\n              \"subject\": {\n                \"reference\": \"Patient/Patient7\"\n              },\n              \"performer\": [\n                {\n                  \"reference\": \"Organization/OrganizationShared\"\n                }\n              ],\n              \"valueQuantity\": {\n                \"value\": 176,\n                \"code\": \"g/L\",\n                \"system\": \"http://unitsofmeasure.org\",\n                \"unit\": \"g/L\"\n              },\n              \"referenceRange\": [\n                {\n                  \"low\": {\n                    \"value\": 135,\n                    \"code\": \"g/L\",\n                    \"system\": \"http://unitsofmeasure.org\",\n                    \"unit\": \"g/L\"\n                  },\n                  \"high\": {\n                    \"value\": 180,\n                    \"code\": \"g/L\",\n                    \"system\": \"http://unitsofmeasure.org\",\n                    \"unit\": \"g/L\"\n                  }\n                }\n              ]\n            }\n          },\n          {\n            \"fullUrl\": \"http://example.org/Observation/r7-2\",\n            \"resource\": {\n              \"resourceType\": \"Observation\",\n              \"id\": \"r7-2\",\n              \"status\": \"final\",\n              \"code\": {\n                \"coding\": [\n                  {\n                    \"code\": \"789-8\",\n                    \"system\": \"http://loinc.org\",\n                    \"display\": \"Erythrocytes [#/volume] in Blood by Automated count\"\n                  }\n                ],\n                \"text\": \"Red Cell Count\"\n              },\n              \"subject\": {\n                \"reference\": \"Patient/Patient7\"\n              },\n              \"performer\": [\n                {\n                  \"reference\": \"Organization/OrganizationShared\"\n                }\n              ],\n              \"valueQuantity\": {\n                \"value\": 5.9,\n                \"code\": \"10*12/L\",\n                \"system\": \"http://unitsofmeasure.org\",\n                \"unit\": \"x10*12/L\"\n              },\n              \"referenceRange\": [\n                {\n                  \"low\": {\n                    \"value\": 4.2,\n                    \"code\": \"10*12/L\",\n                    \"system\": \"http://unitsofmeasure.org\",\n                    \"unit\": \"x10*12/L\"\n                  },\n                  \"high\": {\n                    \"value\": 6,\n                    \"code\": \"10*12/L\",\n                    \"system\": \"http://unitsofmeasure.org\",\n                    \"unit\": \"x10*12/L\"\n                  }\n                }\n              ]\n            }\n          }\n        ]\n      }\n    }\n  ]\n}\n",
					"options": {
						"raw": {
							"language": "json"
						}
					}
				},
				"url": {
					"raw": "{{cpgServer}}/PlanDefinition/$questionnaire",
					"host": [
						"{{cpgServer}}"
					],
					"path": [
						"PlanDefinition",
						"$questionnaire"
					]
				}
			},
			"response": []
		},
		{
			"name": "Case2",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							""
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [],
				"body": {
					"mode": "raw",
					"raw": "{\n  \"resourceType\": \"Parameters\",\n  \"id\": \"Parameters2\",\n  \"parameter\": [\n    {\n      \"name\": \"url\",\n      \"valueUri\": \"http://example.org/PlanDefinition/SulfasalazineMonitoringRecommendation\"\n    },\n    {\n      \"name\": \"version\",\n      \"valueString\": \"0.1.0\"\n    },\n    {\n      \"name\": \"data\",\n      \"resource\": {\n        \"resourceType\": \"Bundle\",\n        \"id\": \"BundleCase8\",\n        \"type\": \"collection\",\n        \"entry\": [\n          {\n            \"fullUrl\": \"http://example.org/Patient/Patient8\",\n            \"resource\": {\n              \"resourceType\": \"Patient\",\n              \"id\": \"Patient8\",\n              \"name\": [\n                {\n                  \"family\": \"patient8\"\n                }\n              ]\n            }\n          },\n          {\n            \"fullUrl\": \"http://example.org/Practitioner/PractitionerShared\",\n            \"resource\": {\n              \"resourceType\": \"Practitioner\",\n              \"id\": \"PractitionerShared\",\n              \"name\": [\n                {\n                  \"family\": \"practitionershared\"\n                }\n              ]\n            }\n          },\n          {\n            \"fullUrl\": \"http://example.org/Organization/OrganizationShared\",\n            \"resource\": {\n              \"resourceType\": \"Organization\",\n              \"id\": \"OrganizationShared\",\n              \"name\": \"organizationshared\"\n            }\n          },\n          {\n            \"fullUrl\": \"http://example.org/Encounter/Encounter8\",\n            \"resource\": {\n              \"resourceType\": \"Encounter\",\n              \"id\": \"Encounter8\",\n              \"status\": \"in-progress\",\n              \"class\": {\n                \"code\": \"AMB\",\n                \"system\": \"http://terminology.hl7.org/CodeSystem/v3-ActCode\",\n                \"display\": \"ambulatory\"\n              },\n              \"subject\": {\n                \"reference\": \"Patient/Patient8\"\n              },\n              \"participant\": [\n                {\n                  \"type\": [\n                    {\n                      \"coding\": [\n                        {\n                          \"code\": \"PPRF\",\n                          \"system\": \"http://terminology.hl7.org/CodeSystem/v3-ParticipationType\",\n                          \"display\": \"primary performer\"\n                        }\n                      ]\n                    }\n                  ],\n                  \"individual\": {\n                    \"reference\": \"Practitioner/PractitionerShared\"\n                  }\n                }\n              ],\n              \"serviceProvider\": {\n                \"reference\": \"Organization/OrganizationShared\"\n              }\n            }\n          },\n          {\n            \"fullUrl\": \"http://example.org/MedictionRequest/MedicationRequest8\",\n            \"resource\": {\n              \"resourceType\": \"MedicationRequest\",\n              \"id\": \"MedicationRequest8\",\n              \"status\": \"active\",\n              \"intent\": \"order\",\n              \"subject\": {\n                \"reference\": \"Patient/Patient8\"\n              },\n              \"medicationCodeableConcept\": {\n                \"coding\": [\n                  {\n                    \"code\": \"A07EC01\",\n                    \"system\": \"http://www.whocc.no/atc\",\n                    \"display\": \"Sulfasalazine\"\n                  }\n                ]\n              }\n            }\n          },\n          {\n            \"fullUrl\": \"http://example.org/DiagnosticReport/DiagnosticReport8\",\n            \"resource\": {\n              \"resourceType\": \"DiagnosticReport\",\n              \"id\": \"DiagnosticReport8\",\n              \"meta\": {\n                \"tag\": [\n                  {\n                    \"code\": \"01\",\n                    \"system\": \"http://example.org/fhir/CodeSystem/workflow-codes\",\n                    \"display\": \"Needs Review\"\n                  }\n                ]\n              },\n              \"identifier\": [\n                {\n                  \"system\": \"http://acme.com/lab/reports\",\n                  \"value\": \"5234342\"\n                }\n              ],\n              \"status\": \"final\",\n              \"category\": [\n                {\n                  \"coding\": [\n                    {\n                      \"code\": \"HM\",\n                      \"system\": \"http://terminology.hl7.org/CodeSystem/v2-0074\"\n                    }\n                  ]\n                }\n              ],\n              \"code\": {\n                \"coding\": [\n                  {\n                    \"code\": \"58410-2\",\n                    \"system\": \"http://loinc.org\",\n                    \"display\": \"Complete blood count (hemogram) panel - Blood by Automated count\"\n                  },\n                  {\n                    \"code\": \"CBC\",\n                    \"display\": \"MASTER FULL BLOOD COUNT\"\n                  }\n                ],\n                \"text\": \"Complete Blood Count\"\n              },\n              \"subject\": {\n                \"reference\": \"Patient/Patient8\"\n              },\n              \"encounter\": {\n                \"reference\": \"Encounter/Encounter8\"\n              },\n              \"effectiveDateTime\": \"2021-01-04T08:30:00+11:00\",\n              \"issued\": \"2021-01-04T11:45:33+11:00\",\n              \"performer\": [\n                {\n                  \"reference\": \"Organization/OrganizationShared\"\n                }\n              ],\n              \"result\": [\n                {\n                  \"reference\": \"Observation/r8-1\"\n                },\n                {\n                  \"reference\": \"Observation/r8-2\"\n                }\n              ]\n            }\n          },\n          {\n            \"fullUrl\": \"http://example.org/Observation/r8-1\",\n            \"resource\": {\n              \"resourceType\": \"Observation\",\n              \"id\": \"r8-1\",\n              \"status\": \"final\",\n              \"code\": {\n                \"coding\": [\n                  {\n                    \"code\": \"718-7\",\n                    \"system\": \"http://loinc.org\",\n                    \"display\": \"Hemoglobin [Mass/volume] in Blood\"\n                  }\n                ],\n                \"text\": \"Haemoglobin\"\n              },\n              \"subject\": {\n                \"reference\": \"Patient/Patient8\"\n              },\n              \"performer\": [\n                {\n                  \"reference\": \"Organization/OrganizationShared\"\n                }\n              ],\n              \"valueQuantity\": {\n                \"value\": 176,\n                \"code\": \"g/L\",\n                \"system\": \"http://unitsofmeasure.org\",\n                \"unit\": \"g/L\"\n              },\n              \"referenceRange\": [\n                {\n                  \"low\": {\n                    \"value\": 135,\n                    \"code\": \"g/L\",\n                    \"system\": \"http://unitsofmeasure.org\",\n                    \"unit\": \"g/L\"\n                  },\n                  \"high\": {\n                    \"value\": 180,\n                    \"code\": \"g/L\",\n                    \"system\": \"http://unitsofmeasure.org\",\n                    \"unit\": \"g/L\"\n                  }\n                }\n              ]\n            }\n          },\n          {\n            \"fullUrl\": \"http://example.org/Observation/r8-2\",\n            \"resource\": {\n              \"resourceType\": \"Observation\",\n              \"id\": \"r8-2\",\n              \"status\": \"final\",\n              \"code\": {\n                \"coding\": [\n                  {\n                    \"code\": \"789-8\",\n                    \"system\": \"http://loinc.org\",\n                    \"display\": \"Erythrocytes [#/volume] in Blood by Automated count\"\n                  }\n                ],\n                \"text\": \"Red Cell Count\"\n              },\n              \"subject\": {\n                \"reference\": \"Patient/Patient8\"\n              },\n              \"performer\": [\n                {\n                  \"reference\": \"Organization/OrganizationShared\"\n                }\n              ],\n              \"valueQuantity\": {\n                \"value\": 5.9,\n                \"code\": \"10*12/L\",\n                \"system\": \"http://unitsofmeasure.org\",\n                \"unit\": \"x10*12/L\"\n              },\n              \"referenceRange\": [\n                {\n                  \"low\": {\n                    \"value\": 4.2,\n                    \"code\": \"10*12/L\",\n                    \"system\": \"http://unitsofmeasure.org\",\n                    \"unit\": \"x10*12/L\"\n                  },\n                  \"high\": {\n                    \"value\": 6,\n                    \"code\": \"10*12/L\",\n                    \"system\": \"http://unitsofmeasure.org\",\n                    \"unit\": \"x10*12/L\"\n                  }\n                }\n              ]\n            }\n          }\n        ]\n      }\n    }\n  ]\n}\n",
					"options": {
						"raw": {
							"language": "json"
						}
					}
				},
				"url": {
					"raw": "{{cpgServer}}/PlanDefinition/$questionnaire",
					"host": [
						"{{cpgServer}}"
					],
					"path": [
						"PlanDefinition",
						"$questionnaire"
					]
				}
			},
			"response": []
		}
	],
	"event": [
		{
			"listen": "prerequest",
			"script": {
				"type": "text/javascript",
				"exec": [
					"/**",
					" * Delete the id and text as this can vary per request",
					" */",
					"",
					"const deleteLinkId = (i) => {",
					"  if (i.item) {",
					"    i.item.forEach(subI => {",
					"      delete subI.linkId",
					"      deleteLinkId(subI)",
					"    })",
					"  }",
					"}",
					"",
					"Object.prototype.testPrepare = function testPrepare(resource) {",
					"    delete resource.id;",
					"    delete resource.meta;",
					"    delete resource.url;",
					"    delete resource.description;",
					"    resource.item.forEach(item => {",
					"      delete item.linkId",
					"      deleteLinkId(item)",
					"    })",
					"    return resource;",
					"}",
					"",
					"",
					"/**",
					" * Find difference between two objects",
					" * @param  {object} origObj - Source object to compare newObj against",
					" * @param  {object} newObj  - New object with potential changes",
					" * @return {object} differences",
					" */",
					"function difference(origObj, newObj) {",
					"  function changes(newObj, origObj) {",
					"    let arrayIndexCounter = 0",
					"    return _.transform(newObj, function (result, value, key) {",
					"      if (!_.isEqual(value, origObj[key])) {",
					"        let resultKey = _.isArray(origObj) ? arrayIndexCounter++ : key",
					"        result[resultKey] = (_.isObject(value) && _.isObject(origObj[key])) ? changes(value, origObj[key]) : value",
					"      }",
					"    })",
					"  }",
					"  return changes(newObj, origObj)",
					"}",
					"",
					"/**",
					" * Does a deep equal comparison, uses console.log to show diffs if fails.",
					" * ",
					" * @example",
					" * pm.test(\"My test\", function() {",
					" *   _.expectToDeepEqual(pm.response.json(), expected, console);",
					" * });",
					" */",
					"Object.prototype.expectToDeepEqual = (actual, expected, console = console) => {",
					"    try {",
					"        pm.expect(_.testPrepare(actual)).to.deep.equal(_.testPrepare(expected));        ",
					"    } catch (e) {",
					"        const diff = difference(e.expected, e.actual);",
					"        console.log('difference expected to actual', diff);",
					"        console.log({ actual: e.actual, expected: e.expected});",
					"        e.message = `*** See Console *** ${e.message}`;",
					"        throw new Error(e);",
					"    }",
					"}"
				]
			}
		},
		{
			"listen": "test",
			"script": {
				"type": "text/javascript",
				"exec": [
					""
				]
			}
		}
	],
	"variable": [
		{
			"key": "cpgServer",
			"value": "http://localhost:9001",
			"type": "string"
		},
		{
			"key": "contentEndpointType",
			"value": "hl7-fhir-file",
			"type": "string"
		},
		{
			"key": "contentEndpointAddress",
			"value": "file:///Users/taylorkingston/projects/cqf-pd-apply/pd-apply/connectathon-33/output",
			"type": "string"
		},
		{
			"key": "terminologyEndpointAddress",
			"value": "http://localhost:8080/fhir",
			"type": "string"
		},
		{
			"key": "terminologyEndpointType",
			"value": "hl7-fhir-rest",
			"type": "string"
		}
	]
}